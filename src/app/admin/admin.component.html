<div *ngIf="esAdmin()" class="container mt-4">
  <h2 class="mb-4 text-center">Panel de Administraci√≥n</h2>

  <!-- Men√∫ de Navegaci√≥n -->
  <ul class="nav nav-pills mb-4 justify-content-center">
    <li class="nav-item">
      <a
        class="nav-link"
        [class.active]="seccionActiva === 'invitaciones'"
        (click)="seccionActiva = 'invitaciones'"
        href="javascript:void(0)"
        >Invitaciones</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        [class.active]="seccionActiva === 'partidos'"
        (click)="seccionActiva = 'partidos'"
        href="javascript:void(0)"
        >Jornada (Partidos)</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        [class.active]="seccionActiva === 'clasificacion'"
        (click)="seccionActiva = 'clasificacion'"
        href="javascript:void(0)"
        >Clasificaci√≥n</a
      >
    </li>
  </ul>

  <!-- SECCI√ìN INVITACIONES -->
  <div *ngIf="seccionActiva === 'invitaciones'">
    <h3>C√≥digos de Registro</h3>
    <button class="btn btn-success mb-3" (click)="generarNuevoCodigo()">‚ûï Generar C√≥digo</button>
    <ul class="list-group">
      <li
        *ngFor="let c of codigos"
        class="list-group-item d-flex justify-content-between align-items-center"
      >
        <span
          ><strong>{{ c.code }}</strong></span
        >
        <span
          [class.text-danger]="c.used"
          [class.text-success]="!c.used"
          class="badge rounded-pill bg-light text-dark border"
        >
          {{ c.used ? 'üî¥ Ya usado' : 'üü¢ Disponible' }}
        </span>
      </li>
    </ul>
  </div>

  <!-- SECCI√ìN PARTIDOS -->
  <div *ngIf="seccionActiva === 'partidos'">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Lista de Partidos</h3>
      <button class="btn btn-primary" (click)="nuevoPartido()">‚ûï Nuevo Partido</button>
    </div>

    <!-- Tabla Partidos -->
    <div class="table-responsive" *ngIf="!partidoEditando">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Fecha</th>
            <th>Local</th>
            <th>Visitante</th>
            <th>Resultado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of partidos">
            <td>{{ p.fecha | date : 'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ p.equipoLocal }}</td>
            <td>{{ p.equipoVisitante }}</td>
            <td>
              <span *ngIf="p.isPlayed">{{ p.golesLocal }} - {{ p.golesVisitante }}</span>
              <span *ngIf="!p.isPlayed" class="text-muted">No jugado</span>
            </td>
            <td>
              <button class="btn btn-sm btn-warning me-2" (click)="editarPartido(p)">‚úèÔ∏è</button>
              <button class="btn btn-sm btn-danger" (click)="eliminarPartido(p._id)">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Formulario Edici√≥n Partido -->
    <div *ngIf="partidoEditando" class="card p-4 bg-light">
      <h4>{{ partidoEditando._id ? 'Editar Partido' : 'Nuevo Partido' }}</h4>
      <form (ngSubmit)="guardarPartido()">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label>Jornada (T√≠tulo)</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="partidoEditando.jornada"
              name="jornada"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label>Ubicaci√≥n</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="partidoEditando.ubicacion"
              name="ubicacion"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label>Equipo Local</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="partidoEditando.equipoLocal"
              name="equipoLocal"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label>Equipo Visitante</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="partidoEditando.equipoVisitante"
              name="equipoVisitante"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label>Fecha (YYYY-MM-DD)</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="partidoEditando.fecha"
              name="fecha"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label>Hora</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="partidoEditando.hora"
              name="hora"
              required
            />
          </div>
        </div>

        <div class="form-check mb-3">
          <input
            class="form-check-input"
            type="checkbox"
            [(ngModel)]="partidoEditando.isPlayed"
            name="isPlayed"
            id="isPlayed"
          />
          <label class="form-check-label" for="isPlayed">Partido Jugado</label>
        </div>

        <div class="row" *ngIf="partidoEditando.isPlayed">
          <div class="col-md-6 mb-3">
            <label>Goles Local</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="partidoEditando.golesLocal"
              name="golesLocal"
            />
          </div>
          <div class="col-md-6 mb-3">
            <label>Goles Visitante</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="partidoEditando.golesVisitante"
              name="golesVisitante"
            />
          </div>
        </div>

        <div class="mt-3">
          <button type="submit" class="btn btn-success me-2">Guardar</button>
          <button type="button" class="btn btn-secondary" (click)="partidoEditando = null">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- SECCI√ìN CLASIFICACI√ìN (TABLA EDITABLE) -->
  <div *ngIf="seccionActiva === 'clasificacion'">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Tabla de Clasificaci√≥n</h3>
      <!-- Un solo bot√≥n para guardar todo -->
      <button class="btn btn-primary" (click)="guardarTodosLosEquipos()">üíæ Guardar Cambios</button>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead class="table-dark text-center">
          <tr>
            <th>Pos</th>
            <th>Equipo</th>
            <th>PJ</th>
            <th>PG</th>
            <th>PE</th>
            <th>PP</th>
            <th>GF</th>
            <th>GC</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of equipos; let i = index">
            <td class="text-center">{{ i + 1 }}</td>
            <td>
              <input
                type="text"
                class="form-control form-control-sm"
                [(ngModel)]="e.equipo"
                name="equipo{{ i }}"
              />
            </td>
            <td>
              <input
                type="number"
                class="form-control form-control-sm"
                [(ngModel)]="e.partidosJugados"
                style="width: 60px"
              />
            </td>
            <td>
              <input
                type="number"
                class="form-control form-control-sm"
                [(ngModel)]="e.partidosGanados"
                style="width: 60px"
              />
            </td>
            <td>
              <input
                type="number"
                class="form-control form-control-sm"
                [(ngModel)]="e.partidosEmpatados"
                style="width: 60px"
              />
            </td>
            <td>
              <input
                type="number"
                class="form-control form-control-sm"
                [(ngModel)]="e.partidosPerdidos"
                style="width: 60px"
              />
            </td>
            <td>
              <input
                type="number"
                class="form-control form-control-sm"
                [(ngModel)]="e.GF"
                style="width: 60px"
              />
            </td>
            <td>
              <input
                type="number"
                class="form-control form-control-sm"
                [(ngModel)]="e.GC"
                style="width: 60px"
              />
            </td>
            <td class="text-center">
              <button class="btn btn-sm btn-danger" (click)="eliminarEquipo(e._id)">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <button class="btn btn-secondary mt-3" (click)="nuevoEquipo()">‚ûï A√±adir Fila de Equipo</button>

    <!-- Formulario r√°pido para a√±adir equipo si es necesario, o simplificar a√±adiendo filas vac√≠as -->
    <div *ngIf="equipoEditando" class="card p-3 mt-3 bg-light">
      <h5>Nuevo Equipo</h5>
      <form (ngSubmit)="guardarEquipo()">
        <!-- Dej√© esta funci√≥n para el bot√≥n 'add' si lo usas -->
        <div class="row align-items-center">
          <div class="col-md-3">
            <input
              placeholder="Nombre"
              [(ngModel)]="equipoEditando.equipo"
              name="newTeamName"
              class="form-control"
            />
          </div>
          <div class="col-md-3">
            <input
              placeholder="URL Escudo"
              [(ngModel)]="equipoEditando.escudo"
              name="newTeamLogo"
              class="form-control mb-2"
            />
          </div>
          <div class="col-md-3">
            <label class="form-label small">O subir imagen:</label>
            <input
              type="file"
              (change)="onFileSelected($event)"
              class="form-control form-control-sm"
            />
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-success me-2">A√±adir</button>
            <button type="button" class="btn btn-secondary" (click)="equipoEditando = null">
              Cancelar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<div *ngIf="!esAdmin()" class="alert alert-danger mt-4 container">
  No tienes permisos para acceder a esta secci√≥n.
</div>
