<div class="container">
  <div class="header-section">
    <h2>Clasificaci√≥n</h2>

    @if (esAdmin) {
    <button class="boton-editar btn btn-warning" (click)="toggleEdicion()">
      ‚öôÔ∏è {{ modoEdicion ? 'Finalizar Edici√≥n' : 'Editar Clasificaci√≥n' }}
    </button>
    }
  </div>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Pos</th>
          <th>Equipo</th>
          <th>PTS</th>
          <th>PJ</th>
          <th>PG</th>
          <th>PE</th>
          <th>PP</th>
          <th>GF</th>
          <th>GC</th>
          @if (modoEdicion) {
          <th>Acciones</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (equipo of clasificacion; track equipo._id) {
        <tr [class]="getClassForPosition(equipo.posicion)">
          <td class="posicion">{{ equipo.posicion }}</td>

          <td class="equipo-col">
            <div class="d-flex align-items-center gap-2">
              @if (equipo.escudo) { 
                @if (equipo.escudo.startsWith('http')) {
                  <img [src]="equipo.escudo" alt="Escudo" class="escudo-img" />
                } @else {
                  <img [src]="api.URL_IMAGENES + equipo.escudo" alt="Escudo" class="escudo-img" />
                } 
              }

              @if (!modoEdicion) {
                <span class="nombre-equipo">{{ equipo.nombre }}</span>
              }
            </div>

            @if (modoEdicion) {
            <div class="edit-name-container mt-2">
              <input
                type="text"
                [(ngModel)]="equipo.nombre"
                class="form-control form-control-sm mb-1"
                placeholder="Nombre del equipo"
              />
              <input
                type="file"
                (change)="onFileSelected($event, equipo)"
                class="form-control form-control-sm"
                accept="image/*"
              />
              <small class="text-muted d-block mt-1">Archivo actual: {{ equipo.escudo }}</small>
            </div>
            }
          </td>

          <td class="fw-bold">{{ equipo.puntos }}</td>

          <td>
            @if (modoEdicion) {
            <input type="number" [(ngModel)]="equipo.partidosJugados" class="form-control form-control-sm input-corto" />
            } @else { {{ equipo.partidosJugados }} }
          </td>

          <td>
            @if (modoEdicion) {
            <input type="number" [(ngModel)]="equipo.partidosGanados" class="form-control form-control-sm input-corto" />
            } @else { {{ equipo.partidosGanados }} }
          </td>

          <td>
            @if (modoEdicion) {
            <input type="number" [(ngModel)]="equipo.partidosEmpatados" class="form-control form-control-sm input-corto" />
            } @else { {{ equipo.partidosEmpatados }} }
          </td>

          <td>
            @if (modoEdicion) {
            <input type="number" [(ngModel)]="equipo.partidosPerdidos" class="form-control form-control-sm input-corto" />
            } @else { {{ equipo.partidosPerdidos }} }
          </td>

          <td>
            @if (modoEdicion) {
            <input type="number" [(ngModel)]="equipo.golesFavor" class="form-control form-control-sm input-corto" />
            } @else { {{ equipo.golesFavor }} }
          </td>

          <td>
            @if (modoEdicion) {
            <input type="number" [(ngModel)]="equipo.golesContra" class="form-control form-control-sm input-corto" />
            } @else { {{ equipo.golesContra }} }
          </td>

          @if (modoEdicion) {
          <td>
            <div class="d-flex gap-1">
              <button class="btn btn-sm btn-success" (click)="guardarCambios(equipo)" title="Guardar">üíæ</button>
              <button class="btn btn-sm btn-danger" (click)="eliminarEquipo(equipo._id!)" title="Eliminar">üóëÔ∏è</button>
            </div>
          </td>
          }
        </tr>
        } 

        @if (modoEdicion) {
        <tr class="table-info">
          <td>#</td>
          <td>
            <input
              type="text"
              [(ngModel)]="nuevoEquipo.nombre"
              class="form-control form-control-sm mb-1"
              placeholder="Nombre nuevo equipo"
            />
            <input
              type="file"
              (change)="onFileSelected($event, nuevoEquipo)"
              class="form-control form-control-sm"
              accept="image/*"
            />
          </td>
          <td>-</td>
          <td><input type="number" [(ngModel)]="nuevoEquipo.partidosJugados" class="form-control form-control-sm input-corto" placeholder="PJ" /></td>
          <td><input type="number" [(ngModel)]="nuevoEquipo.partidosGanados" class="form-control form-control-sm input-corto" placeholder="PG" /></td>
          <td><input type="number" [(ngModel)]="nuevoEquipo.partidosEmpatados" class="form-control form-control-sm input-corto" placeholder="PE" /></td>
          <td><input type="number" [(ngModel)]="nuevoEquipo.partidosPerdidos" class="form-control form-control-sm input-corto" placeholder="PP" /></td>
          <td><input type="number" [(ngModel)]="nuevoEquipo.golesFavor" class="form-control form-control-sm input-corto" placeholder="GF" /></td>
          <td><input type="number" [(ngModel)]="nuevoEquipo.golesContra" class="form-control form-control-sm input-corto" placeholder="GC" /></td>
          <td>
            <button class="btn btn-sm btn-primary w-100" (click)="crearEquipo()">‚ûï A√±adir</button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>